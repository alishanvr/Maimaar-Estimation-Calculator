(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,93588,e=>{"use strict";var t=e.i(18566);function a(e,a){let s=(0,t.useParams)(),r=(0,t.usePathname)(),i=s[e],l=r.replace(/\/$/,"").split("/").filter(Boolean)[a];return l&&i!==l?l:i??l??""}e.s(["useRealParam",()=>a])},29736,e=>{"use strict";var t=e.i(9165);async function a(e){let{data:a}=await t.default.get("/projects",{params:e});return a}async function s(e){let{data:a}=await t.default.post("/projects",e);return a.data}async function r(e){let{data:a}=await t.default.get(`/projects/${e}`);return a.data}async function i(e,a){let{data:s}=await t.default.put(`/projects/${e}`,a);return s.data}async function l(e){await t.default.delete(`/projects/${e}`)}async function n(e){let{data:a}=await t.default.get(`/projects/${e}/buildings`);return a.data}async function d(e,a){await t.default.delete(`/projects/${e}/buildings/${a}`)}async function c(e,a){let{data:s}=await t.default.post(`/projects/${e}/buildings/${a}/duplicate`);return s.data}async function o(e){let{data:a}=await t.default.get(`/projects/${e}/history`);return a.data}e.s(["createProject",()=>s,"deleteProject",()=>l,"duplicateBuilding",()=>c,"getProject",()=>r,"getProjectBuildings",()=>n,"getProjectHistory",()=>o,"listProjects",()=>a,"removeBuildingFromProject",()=>d,"updateProject",()=>i])},16185,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(18566),r=e.i(93588),i=e.i(29736),l=e.i(40665);let n=[{label:"Draft",value:"draft"},{label:"In Progress",value:"in_progress"},{label:"Completed",value:"completed"},{label:"Archived",value:"archived"}],d={draft:"bg-gray-100 text-gray-700",in_progress:"bg-yellow-100 text-yellow-700",completed:"bg-green-100 text-green-700",archived:"bg-blue-100 text-blue-700"},c={draft:"bg-gray-100 text-gray-700",calculated:"bg-green-100 text-green-700",finalized:"bg-primary/15 text-primary"};function o(){let e=(0,s.useRouter)(),o=Number((0,r.useRealParam)("id",1)),[m,x]=(0,a.useState)(null),[u,g]=(0,a.useState)([]),[p,h]=(0,a.useState)([]),[y,j]=(0,a.useState)(!0),[b,f]=(0,a.useState)(!1),[N,v]=(0,a.useState)("buildings"),[w,_]=(0,a.useState)(!1),[P,k]=(0,a.useState)({project_name:"",customer_name:"",location:"",description:"",status:"draft"}),C=(0,a.useCallback)(async()=>{j(!0);try{let[e,t]=await Promise.all([(0,i.getProject)(o),(0,i.getProjectBuildings)(o)]);x(e),g(t),k({project_name:e.project_name,customer_name:e.customer_name||"",location:e.location||"",description:e.description||"",status:e.status})}catch{alert("Failed to load project.")}finally{j(!1)}},[o]),B=(0,a.useCallback)(async()=>{try{let e=await (0,i.getProjectHistory)(o);h(e)}catch{h([])}},[o]);(0,a.useEffect)(()=>{C()},[C]),(0,a.useEffect)(()=>{"history"===N&&B()},[N,B]);let S=async()=>{if(m){f(!0);try{let e=await (0,i.updateProject)(m.id,P);x(e),_(!1)}catch{alert("Failed to update project.")}finally{f(!1)}}},$=async()=>{if(m)try{let t=await (0,l.createEstimation)({project_id:m.id,building_name:"New Building",project_name:m.project_name,customer_name:m.customer_name||void 0});e.push(`/estimations/${t.id}`)}catch{alert("Failed to create building.")}},F=async e=>{if(m)try{await (0,i.duplicateBuilding)(m.id,e),C()}catch{alert("Failed to duplicate building.")}},A=async e=>{if(m&&confirm("Remove this building from the project?"))try{await (0,i.removeBuildingFromProject)(m.id,e),C()}catch{alert("Failed to remove building.")}},D=(e,t=2)=>null==e?"—":e.toLocaleString("en-US",{minimumFractionDigits:t,maximumFractionDigits:t});return y?(0,t.jsx)("div",{className:"flex items-center justify-center p-12",children:(0,t.jsx)("p",{className:"text-gray-400",children:"Loading project..."})}):m?(0,t.jsxs)("div",{children:[(0,t.jsx)("button",{onClick:()=>e.push("/projects"),className:"text-sm text-gray-500 hover:text-gray-700 mb-4 transition",children:"← Back to Projects"}),(0,t.jsx)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-6",children:(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsx)("div",{className:"flex-1",children:w?(0,t.jsxs)("div",{className:"space-y-3 max-w-lg",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Project Name"}),(0,t.jsx)("input",{type:"text",value:P.project_name,onChange:e=>k(t=>({...t,project_name:e.target.value})),className:"w-full px-3 py-1.5 text-sm border border-gray-300 rounded-lg"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Customer"}),(0,t.jsx)("input",{type:"text",value:P.customer_name,onChange:e=>k(t=>({...t,customer_name:e.target.value})),className:"w-full px-3 py-1.5 text-sm border border-gray-300 rounded-lg"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Location"}),(0,t.jsx)("input",{type:"text",value:P.location,onChange:e=>k(t=>({...t,location:e.target.value})),className:"w-full px-3 py-1.5 text-sm border border-gray-300 rounded-lg"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Status"}),(0,t.jsx)("select",{value:P.status,onChange:e=>k(t=>({...t,status:e.target.value})),className:"w-full px-3 py-1.5 text-sm border border-gray-300 rounded-lg",children:n.map(e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Description"}),(0,t.jsx)("textarea",{value:P.description,onChange:e=>k(t=>({...t,description:e.target.value})),rows:2,className:"w-full px-3 py-1.5 text-sm border border-gray-300 rounded-lg"})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{onClick:S,disabled:b,className:"bg-primary text-white px-3 py-1.5 rounded-lg text-sm font-medium hover:bg-primary/80 transition disabled:opacity-50",children:b?"Saving...":"Save"}),(0,t.jsx)("button",{onClick:()=>_(!1),className:"text-sm text-gray-500 hover:text-gray-700 transition",children:"Cancel"})]})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,t.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:m.project_name}),(0,t.jsx)("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${d[m.status]}`,children:m.status.replace("_"," ")})]}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-x-6 gap-y-1 text-sm text-gray-500",children:[(0,t.jsxs)("span",{children:[(0,t.jsx)("span",{className:"font-medium text-gray-600",children:"Project #:"})," ",(0,t.jsx)("span",{className:"font-mono",children:m.project_number})]}),m.customer_name&&(0,t.jsxs)("span",{children:[(0,t.jsx)("span",{className:"font-medium text-gray-600",children:"Customer:"})," ",m.customer_name]}),m.location&&(0,t.jsxs)("span",{children:[(0,t.jsx)("span",{className:"font-medium text-gray-600",children:"Location:"})," ",m.location]})]}),m.description&&(0,t.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:m.description})]})}),!w&&(0,t.jsx)("button",{onClick:()=>_(!0),className:"text-sm text-primary hover:text-primary/80 font-medium transition",children:"Edit"})]})}),(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:[(0,t.jsx)("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Buildings"}),(0,t.jsx)("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:m.summary?.building_count??0})]}),(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:[(0,t.jsx)("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Weight (MT)"}),(0,t.jsx)("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:D(m.summary?.total_weight??null,2)})]}),(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:[(0,t.jsx)("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Price (AED)"}),(0,t.jsx)("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:D(m.summary?.total_price??null,0)})]})]}),(0,t.jsxs)("div",{className:"flex gap-1 mb-4 bg-gray-100 rounded-lg p-1 w-fit",children:[(0,t.jsx)("button",{onClick:()=>v("buildings"),className:`px-4 py-1.5 text-sm rounded-md font-medium transition ${"buildings"===N?"bg-white text-gray-900 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:"Buildings"}),(0,t.jsx)("button",{onClick:()=>v("history"),className:`px-4 py-1.5 text-sm rounded-md font-medium transition ${"history"===N?"bg-white text-gray-900 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:"History"})]}),"buildings"===N&&(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-200",children:[(0,t.jsxs)("h3",{className:"text-sm font-semibold text-gray-900",children:["Buildings (",u.length,")"]}),(0,t.jsx)("button",{onClick:$,className:"bg-primary text-white px-3 py-1.5 rounded-lg text-xs font-medium hover:bg-primary/80 transition",children:"+ Add Building"})]}),0===u.length?(0,t.jsx)("div",{className:"p-8 text-center",children:(0,t.jsx)("p",{className:"text-gray-400 text-sm",children:"No buildings in this project yet."})}):(0,t.jsxs)("table",{className:"w-full text-sm",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"bg-gray-50 border-b border-gray-200",children:[(0,t.jsx)("th",{className:"text-left px-4 py-2 font-medium text-gray-500",children:"Building"}),(0,t.jsx)("th",{className:"text-left px-4 py-2 font-medium text-gray-500",children:"Quote #"}),(0,t.jsx)("th",{className:"text-left px-4 py-2 font-medium text-gray-500",children:"Status"}),(0,t.jsx)("th",{className:"text-right px-4 py-2 font-medium text-gray-500",children:"Weight (MT)"}),(0,t.jsx)("th",{className:"text-right px-4 py-2 font-medium text-gray-500",children:"Price (AED)"}),(0,t.jsx)("th",{className:"text-right px-4 py-2 font-medium text-gray-500",children:"Actions"})]})}),(0,t.jsx)("tbody",{className:"divide-y divide-gray-100",children:u.map(a=>(0,t.jsxs)("tr",{className:"hover:bg-gray-50 cursor-pointer transition",onClick:()=>e.push(`/estimations/${a.id}`),children:[(0,t.jsx)("td",{className:"px-4 py-2.5 font-medium text-gray-900",children:a.building_name||"Untitled"}),(0,t.jsx)("td",{className:"px-4 py-2.5 font-mono text-xs text-gray-600",children:a.quote_number||"—"}),(0,t.jsx)("td",{className:"px-4 py-2.5",children:(0,t.jsx)("span",{className:`inline-block px-2 py-0.5 rounded-full text-xs font-medium ${c[a.status]}`,children:a.status})}),(0,t.jsx)("td",{className:"px-4 py-2.5 text-right font-mono text-xs",children:D(a.total_weight_mt,2)}),(0,t.jsx)("td",{className:"px-4 py-2.5 text-right font-mono text-xs",children:D(a.total_price_aed,0)}),(0,t.jsx)("td",{className:"px-4 py-2.5 text-right",children:(0,t.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,t.jsx)("button",{onClick:e=>{e.stopPropagation(),F(a.id)},className:"text-primary hover:text-primary/80 text-xs font-medium transition",children:"Duplicate"}),(0,t.jsx)("button",{onClick:e=>{e.stopPropagation(),A(a.id)},className:"text-red-500 hover:text-red-700 text-xs font-medium transition",children:"Remove"})]})})]},a.id))})]})]}),"history"===N&&(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[(0,t.jsx)("div",{className:"px-4 py-3 border-b border-gray-200",children:(0,t.jsx)("h3",{className:"text-sm font-semibold text-gray-900",children:"Activity History"})}),0===p.length?(0,t.jsx)("div",{className:"p-8 text-center",children:(0,t.jsx)("p",{className:"text-gray-400 text-sm",children:"No activity recorded yet."})}):(0,t.jsx)("div",{className:"divide-y divide-gray-100",children:p.map(e=>(0,t.jsxs)("div",{className:"px-4 py-3 flex items-start gap-3",children:[(0,t.jsx)("div",{className:"w-2 h-2 bg-primary/40 rounded-full mt-1.5 flex-shrink-0"}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:"text-sm text-gray-900",children:e.description}),(0,t.jsxs)("p",{className:"text-xs text-gray-500 mt-0.5",children:[e.causer_name&&(0,t.jsx)("span",{className:"font-medium",children:e.causer_name}),e.causer_name&&" · ",new Date(e.created_at).toLocaleString("en-GB",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]})]},e.id))})]})]}):(0,t.jsx)("div",{className:"flex items-center justify-center p-12",children:(0,t.jsx)("p",{className:"text-red-500",children:"Project not found."})})}e.s(["default",()=>o])}]);