(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,55225,25898,e=>{"use strict";var t=e.i(95003);function a(e,t=2){return null==e?"—":e.toLocaleString("en-US",{minimumFractionDigits:t,maximumFractionDigits:t})}function s(e,t,r,i=2){return null==e?"—":a(e*t,i)+" "+r}function r(e,t,s,i=2){return null==e?"—":a(e*t,i)+" "+s+"/MT"}function i(e,t=2){return a(e,t)+"%"}function l(){let{branding:e}=(0,t.useBranding)(),{display_currency:a,currency_symbol:i,exchange_rate:l}=e;return{currency:a,symbol:i,rate:l,convert:e=>e*l,format:(e,t=2)=>s(e,l,i,t),formatPerMT:(e,t=2)=>r(e,l,i,t),label:e=>`${e} (${i})`}}e.s(["formatCurrency",()=>s,"formatCurrencyPerMT",()=>r,"formatNumber",()=>a,"formatPct",()=>i],25898),e.s(["useCurrency",()=>l],55225)},93588,e=>{"use strict";var t=e.i(18566);function a(e,a){let s=(0,t.useParams)(),r=(0,t.usePathname)(),i=s[e],l=r.replace(/\/$/,"").split("/").filter(Boolean)[a];return l&&i!==l?l:i??l??""}e.s(["useRealParam",()=>a])},29736,e=>{"use strict";var t=e.i(9165);async function a(e){let{data:a}=await t.default.get("/projects",{params:e});return a}async function s(e){let{data:a}=await t.default.post("/projects",e);return a.data}async function r(e){let{data:a}=await t.default.get(`/projects/${e}`);return a.data}async function i(e,a){let{data:s}=await t.default.put(`/projects/${e}`,a);return s.data}async function l(e){await t.default.delete(`/projects/${e}`)}async function n(e){let{data:a}=await t.default.get(`/projects/${e}/buildings`);return a.data}async function c(e,a){await t.default.delete(`/projects/${e}/buildings/${a}`)}async function d(e,a){let{data:s}=await t.default.post(`/projects/${e}/buildings/${a}/duplicate`);return s.data}async function o(e){let{data:a}=await t.default.get(`/projects/${e}/history`);return a.data}e.s(["createProject",()=>s,"deleteProject",()=>l,"duplicateBuilding",()=>d,"getProject",()=>r,"getProjectBuildings",()=>n,"getProjectHistory",()=>o,"listProjects",()=>a,"removeBuildingFromProject",()=>c,"updateProject",()=>i])},16185,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(18566),r=e.i(93588),i=e.i(55225),l=e.i(29736),n=e.i(40665);let c=[{label:"Draft",value:"draft"},{label:"In Progress",value:"in_progress"},{label:"Completed",value:"completed"},{label:"Archived",value:"archived"}],d={draft:"bg-gray-100 text-gray-700",in_progress:"bg-yellow-100 text-yellow-700",completed:"bg-green-100 text-green-700",archived:"bg-blue-100 text-blue-700"},o={draft:"bg-gray-100 text-gray-700",calculated:"bg-green-100 text-green-700",finalized:"bg-primary/15 text-primary"};function m(){let e=(0,s.useRouter)(),m=Number((0,r.useRealParam)("id",1)),{symbol:x,format:u}=(0,i.useCurrency)(),[g,p]=(0,a.useState)(null),[h,y]=(0,a.useState)([]),[j,b]=(0,a.useState)([]),[f,N]=(0,a.useState)(!0),[v,w]=(0,a.useState)(!1),[_,P]=(0,a.useState)("buildings"),[C,k]=(0,a.useState)(!1),[B,S]=(0,a.useState)({project_name:"",customer_name:"",location:"",description:"",status:"draft"}),$=(0,a.useCallback)(async()=>{N(!0);try{let[e,t]=await Promise.all([(0,l.getProject)(m),(0,l.getProjectBuildings)(m)]);p(e),y(t),S({project_name:e.project_name,customer_name:e.customer_name||"",location:e.location||"",description:e.description||"",status:e.status})}catch{alert("Failed to load project.")}finally{N(!1)}},[m]),F=(0,a.useCallback)(async()=>{try{let e=await (0,l.getProjectHistory)(m);b(e)}catch{b([])}},[m]);(0,a.useEffect)(()=>{$()},[$]),(0,a.useEffect)(()=>{"history"===_&&F()},[_,F]);let T=async()=>{if(g){w(!0);try{let e=await (0,l.updateProject)(g.id,B);p(e),k(!1)}catch{alert("Failed to update project.")}finally{w(!1)}}},D=async()=>{if(g)try{let t=await (0,n.createEstimation)({project_id:g.id,building_name:"New Building",project_name:g.project_name,customer_name:g.customer_name||void 0});e.push(`/estimations/${t.id}`)}catch{alert("Failed to create building.")}},R=async e=>{if(g)try{await (0,l.duplicateBuilding)(g.id,e),$()}catch{alert("Failed to duplicate building.")}},A=async e=>{if(g&&confirm("Remove this building from the project?"))try{await (0,l.removeBuildingFromProject)(g.id,e),$()}catch{alert("Failed to remove building.")}},L=(e,t=2)=>null==e?"—":e.toLocaleString("en-US",{minimumFractionDigits:t,maximumFractionDigits:t});return f?(0,t.jsx)("div",{className:"flex items-center justify-center p-12",children:(0,t.jsx)("p",{className:"text-gray-400",children:"Loading project..."})}):g?(0,t.jsxs)("div",{children:[(0,t.jsx)("button",{onClick:()=>e.push("/projects"),className:"text-sm text-gray-500 hover:text-gray-700 mb-4 transition",children:"← Back to Projects"}),(0,t.jsx)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-6",children:(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsx)("div",{className:"flex-1",children:C?(0,t.jsxs)("div",{className:"space-y-3 max-w-lg",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Project Name"}),(0,t.jsx)("input",{type:"text",value:B.project_name,onChange:e=>S(t=>({...t,project_name:e.target.value})),className:"w-full px-3 py-1.5 text-sm border border-gray-300 rounded-lg"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Customer"}),(0,t.jsx)("input",{type:"text",value:B.customer_name,onChange:e=>S(t=>({...t,customer_name:e.target.value})),className:"w-full px-3 py-1.5 text-sm border border-gray-300 rounded-lg"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Location"}),(0,t.jsx)("input",{type:"text",value:B.location,onChange:e=>S(t=>({...t,location:e.target.value})),className:"w-full px-3 py-1.5 text-sm border border-gray-300 rounded-lg"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Status"}),(0,t.jsx)("select",{value:B.status,onChange:e=>S(t=>({...t,status:e.target.value})),className:"w-full px-3 py-1.5 text-sm border border-gray-300 rounded-lg",children:c.map(e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Description"}),(0,t.jsx)("textarea",{value:B.description,onChange:e=>S(t=>({...t,description:e.target.value})),rows:2,className:"w-full px-3 py-1.5 text-sm border border-gray-300 rounded-lg"})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{onClick:T,disabled:v,className:"bg-primary text-white px-3 py-1.5 rounded-lg text-sm font-medium hover:bg-primary/80 transition disabled:opacity-50",children:v?"Saving...":"Save"}),(0,t.jsx)("button",{onClick:()=>k(!1),className:"text-sm text-gray-500 hover:text-gray-700 transition",children:"Cancel"})]})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,t.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:g.project_name}),(0,t.jsx)("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${d[g.status]}`,children:g.status.replace("_"," ")})]}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-x-6 gap-y-1 text-sm text-gray-500",children:[(0,t.jsxs)("span",{children:[(0,t.jsx)("span",{className:"font-medium text-gray-600",children:"Project #:"})," ",(0,t.jsx)("span",{className:"font-mono",children:g.project_number})]}),g.customer_name&&(0,t.jsxs)("span",{children:[(0,t.jsx)("span",{className:"font-medium text-gray-600",children:"Customer:"})," ",g.customer_name]}),g.location&&(0,t.jsxs)("span",{children:[(0,t.jsx)("span",{className:"font-medium text-gray-600",children:"Location:"})," ",g.location]})]}),g.description&&(0,t.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:g.description})]})}),!C&&(0,t.jsx)("button",{onClick:()=>k(!0),className:"text-sm text-primary hover:text-primary/80 font-medium transition",children:"Edit"})]})}),(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:[(0,t.jsx)("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Buildings"}),(0,t.jsx)("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:g.summary?.building_count??0})]}),(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:[(0,t.jsx)("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Weight (MT)"}),(0,t.jsx)("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:L(g.summary?.total_weight??null,2)})]}),(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:[(0,t.jsxs)("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider",children:["Total Price (",x,")"]}),(0,t.jsx)("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:u(g.summary?.total_price??null,0)})]})]}),(0,t.jsxs)("div",{className:"flex gap-1 mb-4 bg-gray-100 rounded-lg p-1 w-fit",children:[(0,t.jsx)("button",{onClick:()=>P("buildings"),className:`px-4 py-1.5 text-sm rounded-md font-medium transition ${"buildings"===_?"bg-white text-gray-900 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:"Buildings"}),(0,t.jsx)("button",{onClick:()=>P("history"),className:`px-4 py-1.5 text-sm rounded-md font-medium transition ${"history"===_?"bg-white text-gray-900 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:"History"})]}),"buildings"===_&&(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-200",children:[(0,t.jsxs)("h3",{className:"text-sm font-semibold text-gray-900",children:["Buildings (",h.length,")"]}),(0,t.jsx)("button",{onClick:D,className:"bg-primary text-white px-3 py-1.5 rounded-lg text-xs font-medium hover:bg-primary/80 transition",children:"+ Add Building"})]}),0===h.length?(0,t.jsx)("div",{className:"p-8 text-center",children:(0,t.jsx)("p",{className:"text-gray-400 text-sm",children:"No buildings in this project yet."})}):(0,t.jsxs)("table",{className:"w-full text-sm",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"bg-gray-50 border-b border-gray-200",children:[(0,t.jsx)("th",{className:"text-left px-4 py-2 font-medium text-gray-500",children:"Building"}),(0,t.jsx)("th",{className:"text-left px-4 py-2 font-medium text-gray-500",children:"Quote #"}),(0,t.jsx)("th",{className:"text-left px-4 py-2 font-medium text-gray-500",children:"Status"}),(0,t.jsx)("th",{className:"text-right px-4 py-2 font-medium text-gray-500",children:"Weight (MT)"}),(0,t.jsxs)("th",{className:"text-right px-4 py-2 font-medium text-gray-500",children:["Price (",x,")"]}),(0,t.jsx)("th",{className:"text-right px-4 py-2 font-medium text-gray-500",children:"Actions"})]})}),(0,t.jsx)("tbody",{className:"divide-y divide-gray-100",children:h.map(a=>(0,t.jsxs)("tr",{className:"hover:bg-gray-50 cursor-pointer transition",onClick:()=>e.push(`/estimations/${a.id}`),children:[(0,t.jsx)("td",{className:"px-4 py-2.5 font-medium text-gray-900",children:a.building_name||"Untitled"}),(0,t.jsx)("td",{className:"px-4 py-2.5 font-mono text-xs text-gray-600",children:a.quote_number||"—"}),(0,t.jsx)("td",{className:"px-4 py-2.5",children:(0,t.jsx)("span",{className:`inline-block px-2 py-0.5 rounded-full text-xs font-medium ${o[a.status]}`,children:a.status})}),(0,t.jsx)("td",{className:"px-4 py-2.5 text-right font-mono text-xs",children:L(a.total_weight_mt,2)}),(0,t.jsx)("td",{className:"px-4 py-2.5 text-right font-mono text-xs",children:u(a.total_price_aed,0)}),(0,t.jsx)("td",{className:"px-4 py-2.5 text-right",children:(0,t.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,t.jsx)("button",{onClick:e=>{e.stopPropagation(),R(a.id)},className:"text-primary hover:text-primary/80 text-xs font-medium transition",children:"Duplicate"}),(0,t.jsx)("button",{onClick:e=>{e.stopPropagation(),A(a.id)},className:"text-red-500 hover:text-red-700 text-xs font-medium transition",children:"Remove"})]})})]},a.id))})]})]}),"history"===_&&(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[(0,t.jsx)("div",{className:"px-4 py-3 border-b border-gray-200",children:(0,t.jsx)("h3",{className:"text-sm font-semibold text-gray-900",children:"Activity History"})}),0===j.length?(0,t.jsx)("div",{className:"p-8 text-center",children:(0,t.jsx)("p",{className:"text-gray-400 text-sm",children:"No activity recorded yet."})}):(0,t.jsx)("div",{className:"divide-y divide-gray-100",children:j.map(e=>(0,t.jsxs)("div",{className:"px-4 py-3 flex items-start gap-3",children:[(0,t.jsx)("div",{className:"w-2 h-2 bg-primary/40 rounded-full mt-1.5 flex-shrink-0"}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:"text-sm text-gray-900",children:e.description}),(0,t.jsxs)("p",{className:"text-xs text-gray-500 mt-0.5",children:[e.causer_name&&(0,t.jsx)("span",{className:"font-medium",children:e.causer_name}),e.causer_name&&" · ",new Date(e.created_at).toLocaleString("en-GB",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]})]},e.id))})]})]}):(0,t.jsx)("div",{className:"flex items-center justify-center p-12",children:(0,t.jsx)("p",{className:"text-red-500",children:"Project not found."})})}e.s(["default",()=>m])}]);